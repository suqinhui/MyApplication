<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link href="../css/mui.min.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="../css/mui.css"/>
    <link href="../css/hwl.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="../css/iconfont.css"/>
    <!--标准mui.css-->
    <!--App自定义的css-->
    <link rel="stylesheet" type="text/css" href="../css/app.css"/>
    <link href="../css/mui.picker.css" rel="stylesheet"/>
    <link href="../css/mui.poppicker.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css"/>
    <!--<link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css" />-->
    <style>
        .slide-img {
        height: 150px;
        }
    </style>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="../SUI Mobile/lib/css/sm.min.css">
    <link rel="stylesheet" href="../SUI Mobile/lib/css/sm-extend.min.css">

</head>
<body>

<div class="page-group" id="page_group">
    <div class="page page-current" id="page_book_city">
        <!-- 搜索框 -->
        <div class="bar bar-nav">
            <div class="searchbar" id="search">
                <div class="search-input">
                    <label class="icon icon-search"></label>
                    <input type="search" placeholder='搜索书名' width="100px" disabled/>
                </div>
            </div>
        </div>
        <div class="mui-content" style="margin-bottom: 100px">
            <div id="slider" class="mui-slider">
                <div class="mui-slider-group mui-slider-loop">
                    <!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
                    <div class="mui-slider-item mui-slider-item-duplicate slide-img">
                        <a href="#">
                            <img class="slide-img" src="../images/yuantiao.jpg">
                        </a>
                    </div>
                    <div class="mui-slider-item slide-img">
                        <a href="#">
                            <img class="slide-img" src="../images/1.png">
                        </a>
                    </div>
                    <div class="mui-slider-item slide-img">
                        <a href="#">
                            <img class="slide-img" src="../images/muwu.jpg">
                        </a>
                    </div>
                    <!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
                    <div class="mui-slider-item mui-slider-item-duplicate">
                        <a href="#">
                            <img class="slide-img" src=" ../images/1.png">
                            <!--<p class="mui-slider-title">幸福就是可以一起睡觉</p>-->
                        </a>
                    </div>

                </div>
            </div>
        </div>
        <!-- 工具栏 -->
        <nav class="bar bar-tab">
            <a class="tab-item external active" href="#" name="btn_book_city">
                <span class="icon icon-search"></span>
                <span class="tab-label">书城</span>
            </a>
            <a class="tab-item external" href="#" name="btn_book_list">
                <span class="icon icon-star"></span>
                <span class="tab-label">书单</span>
            </a>
            <a class="tab-item external" href="#" name="btn_me">
                <span class="icon icon-me"></span>
                <span class="tab-label">我</span>
            </a>
        </nav>
        <!-- 这里是页面内容区 -->
        <div class="content" style="margin-top: 105px">
            <!--数据列表-->
            <ul id="" class="mui-table-view mui-table-view-chevron">
            </ul>
        </div>
    </div>
    <div class="page" id="page_book_list">
        <!-- 标题栏 -->
        <header class="bar bar-nav">
            <h4 class="title" style="font-size: 20px">收藏书单</h4>
        </header>
        <!-- 工具栏 -->
        <nav class="bar bar-tab">
            <a class="tab-item external" href="#" name="btn_book_city">
                <span class="icon icon-search"></span>
                <span class="tab-label">书城</span>
            </a>
            <a class="tab-item external active" href="#" name="btn_book_list">
                <span class="icon icon-star"></span>
                <span class="tab-label">书单</span>
            </a>
            <a class="tab-item external" href="#" name="btn_me">
                <span class="icon icon-me"></span>
                <span class="tab-label">我</span>
            </a>
        </nav>

        <!-- 这里是页面内容区 -->
        <div class="content">
            <div style="text-align: center" id="image_empty">
                <img src="../images/empty.png" style="margin-top: 100px">
                <h4 style="margin-top: 20px">暂无收藏书籍</h4>
            </div>
            <ul id="collect_book" class="mui-table-view mui-grid-view mui-grid-9">
            </ul>
        </div>
    </div>
    <div class="page" id="page_me">
        <!-- 工具栏 -->
        <nav class="bar bar-tab">
            <a class="tab-item external" href="#" name="btn_book_city">
                <span class="icon icon-search"></span>
                <span class="tab-label">书城</span>
            </a>
            <a class="tab-item external" href="#" name="btn_book_list">
                <span class="icon icon-star"></span>
                <span class="tab-label">书单</span>
            </a>
            <a class="tab-item external active" href="#" name="btn_me">
                <span class="icon icon-me"></span>
                <span class="tab-label">我</span>
            </a>
        </nav>
        <!-- 这里是页面内容区 -->
        <div class="content">
            <div class="mui-content">
                <div class="" align="center" style="background-color: #46A3FF"><img src="../images/jobhunter/msg_who3.png"
                                                                                    style="background-color: white;border-radius:50%; margin-top: 10px"/>
                    <div class="" style="color: white;" id="nickname"> 陈镜冰</div>
                </div>

                <div style="margin-bottom: 30px;">
                    <ul class="mui-table-view" id="select" type="button">
                        <li class="mui-table-view-cell"><span style=" height:30px; line-height: 30px;"><span
                                class="mui-icon mui-icon-spinner-cycle mui-spin"></span>总积分</span>
                            <a id="all_integration" style="float: right;color: skyblue;" href="javascript:;">
                                <div style="padding-bottom: 5px;"></div>
                                100</a>
                        </li>
                    </ul>
                </div>

                <div class="mui-control-content mui-active ">
                    <ul class="mui-table-view ">
                        <li class="mui-table-view-cell ">
                            <span class="mui-icon mui-icon-spinner-cycle mui-spin"></span><span>今日积分</span>
                            <a id="today_integration" style="float: right;color: skyblue;" href="javascript:;">
                                <div style="padding-bottom: 5px;"></div>
                                100</a>
                        </li>
                        <!--<li class="mui-table-view-cell ">
                            <a href="../post/collectPost.html#post" class="mui-navigate-right "><span class="mui-icon iconfont mui-icon-star "></span>我收藏的书本</a>
                        </li>-->
                        <li class="mui-table-view-cell ">
                            <a href="../me/massage.html" class="mui-navigate-right "><span
                                    class="mui-icon iconfont mui-icon-gear "></span>个人资料设置</a>
                        </li>
                        <li class="mui-table-view-cell ">
                            <!--<button id='demo1' data-options='{}' class=" mui-navigate-right"><span class="mui-icon iconfont mui-icon mui-icon-spinner mui-spin "></span>定时读书</button>-->
                            <a id='demo5' data-options='{"type":"time"}' class="mui-navigate-right btn "><span
                                    class="mui-icon iconfont mui-icon mui-icon-spinner mui-spin "></span>定时读书<span id='timing'
                                                                                                                   style="margin-left: 50%"></span></a>
                        </li>
                    </ul>
                </div>

                <div>
                    <ul>
                        <li class="mui-table-view-cell " style="margin-right: 20px; list-style-type:none;">
                            <a id="to_login"
                               style="text-align: center; margin-right: 10px;background-color: #46A3FF; "><span>退出登录</span></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

</div>
<script src="../js/mui.min.js"></script>
<script src="../js/mui.picker.js"></script>
<script src="../js/mui.picker.min.js"></script>
<script src="../js/mui.poppicker.js"></script>
<script type='text/javascript' src='../SUI Mobile/lib/js/zepto.min.js' charset='utf-8'></script>
<script type='text/javascript' src='../SUI Mobile/lib/js/sm.min.js' charset='utf-8'></script>
<script type='text/javascript' src='../SUI Mobile/lib/js/sm-extend.min.js' charset='utf-8'></script>
<script>
      $(document).ready(function (e) {
        //设置下边栏目的点击事件
        var pageBookCity = $("#page_book_city");
        var pageBookList = $("#page_book_list");
        var pageMe = $("#page_me");
        var btn_book_city = $("a[name='btn_book_city']");
        var btn_book_list = $("a[name='btn_book_list']");
        var btn_me = $("a[name='btn_me']");
        btn_book_city.click(function () {
          pageBookCity.removeClass("page");
          pageBookCity.addClass("page page-current");
          pageBookList.removeClass("page page-current");
          pageBookList.addClass("page");
          pageMe.removeClass("page page-current");
          pageMe.addClass("page");
        });
        btn_book_list.click(function () {
          pageBookCity.removeClass("page page-current");
          pageBookCity.addClass("page");
          pageBookList.removeClass("page");
          pageBookList.addClass("page page-current");
          pageMe.removeClass("page page-current");
          pageMe.addClass("page");
        });
        btn_me.click(function () {
          pageBookCity.removeClass("page page-current");
          pageBookCity.addClass("page");
          pageBookList.removeClass("page page-current");
          pageBookList.addClass("page");
          pageMe.removeClass("page");
          pageMe.addClass("page page-current");
        });


        //设置书城页面
        var search = $("#search");
        search.click(function () {
          window.location.href = "search.html";
        });
        var slider = mui("#slider");
        slider.slider({
          interval: 1000
        });
        var bookList = JsInteractionEvent.getBookList();
        var bookListArray = JSON.parse(bookList);
        //alert(bookListArray.length);
        var table = document.body.querySelector('.mui-table-view');
        for (var i = 0; i < bookListArray.length; i++) {
          var li = document.createElement('li');
          li.className = 'mui-table-view-cell ' + 'book_list';
          var imageSrc = "../images/books/" + bookListArray[i].book_english_name + ".jpg";
          var hrefSrc = "../book/book_info.html?book_english_name=" + bookListArray[i].book_english_name;
          li.innerHTML = '<div>' + '<div class="flex"><a href = ' + hrefSrc + '>' + '<img src=' + imageSrc + ' alt="" style = "height:90px;width:80px"/>' + '<div class="flex-main" style="margin-left: 10px;">' + '<h4>' + bookListArray[i].book_name + '</h4>' + '<p>' + bookListArray[i].author + '</p>' + '<div class="fs-14" style="color: grade;" >' + ' ' + '<div class="fs-14" style="color: blue;">' + bookListArray[i].years + '</div>' + '</div>' + '</a></div>' + '</div>';
          table.appendChild(li);
        }


        //设置收藏书单页面
        var imageEmpty = $("#image_empty");
        var collectBookTable = $("#collect_book");
        var collectBookList = document.body.querySelector('#collect_book');
        var collectBookInfo = JsInteractionEvent.getUserCollectBook();
        var collectBookInfoArray = JSON.parse(collectBookInfo);
        if (collectBookInfoArray.length == 0) {
          imageEmpty.show();
          collectBookTable.hide();
        } else {
          imageEmpty.hide();
          collectBookTable.show();
          for (var j = 0; j < collectBookInfoArray.length; j++) {
            var li = document.createElement('li');
            li.className = 'mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3';
            var imageSrc1 = "../images/books/" + collectBookInfoArray[j].book_english_name + ".jpg";
            var hrefSrc1 = "../book/book_info.html?book_english_name=" + collectBookInfoArray[j].book_english_name;
            var bookName = collectBookInfoArray[j].book_name;
            li.innerHTML = '<a href=' + hrefSrc1 + '>' + '<img src=' + imageSrc1 + ' style="height: 90px;width: 80px;"/>' + '<div class="mui-media-body">' + bookName + '</div> ' + '</a>';
            collectBookList.appendChild(li);
          }
        }


        //设置我页面
        var userInfo = JsInteractionEvent.getUserInfo();
        var userInfoObj = JSON.parse(userInfo);
        var nickname = $("#nickname");
        nickname.html(userInfoObj.nickname);
        var allIntegration = $("#all_integration");
        allIntegration.html(userInfoObj.all_integration);
        var todayIntegration = $("#today_integration");
        todayIntegration.html(userInfoObj.today_integration);
        //设置定时任务，每秒获取用户的今日积分
        window.setInterval(function () {
          var userInfoNew = JsInteractionEvent.getUserInfo();
          var userInfoObjNew = JSON.parse(userInfoNew);
          todayIntegration.html(userInfoObjNew.today_integration);
        }, 1000);
        var timing = $("#timing");
        if (userInfoObj.timing != "0") {
          timing.html(userInfoObj.timing);
        }
        //退出登录
        var toLogin = $("#to_login");
        toLogin.click(function () {
          JsInteractionEvent.toLogin();
        });
      });
      //设置我页面
      (function ($) {
        var result = $('#timing')[0];
        var btns = $('.btn');
        btns.each(function (i, btn) {
          btn.addEventListener('tap', function () {
            var optionsJson = this.getAttribute('data-options') || '{}';
            var options = JSON.parse(optionsJson);
            var id = this.getAttribute('id');
            /*
             * 首次显示时实例化组件
             * 示例为了简洁，将 options 放在了按钮的 dom 上
             * 也可以直接通过代码声明 optinos 用于实例化 DtPicker
             */
            var picker = new $.DtPicker(options);
            picker.show(function (rs) {
              /*
               * rs.value 拼合后的 value
               * rs.text 拼合后的 text
               * rs.y 年，可以通过 rs.y.vaue 和 rs.y.text 获取值和文本
               * rs.m 月，用法同年
               * rs.d 日，用法同年
               * rs.h 时，用法同年
               * rs.i 分（minutes 的第二个字母），用法同年
               */
              result.innerText = rs.text;
              //将时间存到数据库
              JsInteractionEvent.updateTiming(rs.text);
              /*
               * 返回 false 可以阻止选择框的关闭
               * return false;
               */
              /*
               * 释放组件资源，释放后将将不能再操作组件
               * 通常情况下，不需要示放组件，new DtPicker(options) 后，可以一直使用。
               * 当前示例，因为内容较多，如不进行资原释放，在某些设备上会较慢。
               * 所以每次用完便立即调用 dispose 进行释放，下次用时再创建新实例。
               */
              picker.dispose();
            });
          }, false);
        });
      })(mui);
    </script>
<script>
      $.init();
    </script>
</body>
</html>